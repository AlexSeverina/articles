\section{Алгоритм на матричных опреациях}

\subsection{Алгоритм CYK}

Алгоритм Cocke-Younger-Kasami --- один классических алгоритмов синтаксического анализа. 
Он требует, чтобы грамматика находилась в Нормальной Форме Хомского. 
Сложность алгоритма --- $O(n^3)$, где $n$ --- размер входной строки. 

В основе алгоритма лежит динамическое программирование. 
Используются следующие соображения. 

Правило $A \to a$ означает, что 

\[
  A \derives[] a \derives \omega \iff \omega = a\]
  
Правило $A \to B C$ означает, что 

\[A \derives[] B C \derives \omega \iff \exists \omega_1, \omega_2 : \omega = \omega_1 \omega_2, B \derives \omega_1, C \derives \omega_2\]

Или в терминах позиций в строке: 

\[A \derives[] B C \derives \omega \iff \exists k \in [1 \dots |\omega|] : B \derives \omega[1 \dots k], C \derives \omega[k+1 \dots |\omega|]\]

В процессе работы алгоритма заполняется булева трехмерная матрица размера $N \times n \times n$, где $n$~---  размер входной цепочки, $N$~--- количество нетерминалов в нормализованной грамматике. 
$m[A][i][j] = true \iff A \derives \omega[i \dots j]$

Первым шагом инициализируем матрицу, заполнив значения $m[A][i][j] \text{, где }i = j$: 

\begin{itemize}
  \item $m[A][i][i] = true \text{, если в грамматике есть правило } A \to \omega[i]$.
  \item $m[A][i][i] = false$, иначе.
\end{itemize}

Далее используем динамику: предполагаем, что ячейки матрицы $m[A][i'][j']$ заполнены для всех нетерминалов $A$ и пар $i', j': j' - i' < m$.
Тогда можно заполнить ячейки матрицы $m[A][i][j] \text{, где } j - i = m$

\[ m[A][i][j] = \bigvee_{A \to B C}^{}{\bigvee_{k=i}^{j-1}{m[B][i][k] \wedge m[C][k][j]}} \]

По итогу работы алгоритма значение в ячейке $m[S][0][|\omega|]$, где $S$ --- стартовый нетерминал грамматики, отвечает на вопрос о выводимости цепочки $\omega$ в грамматике. 

\begin{example}
  Рассмотрим пример работы алгоритма CYK на грамматике правильных скобочных последовательностей в Нормальной Форме Хомского. 

  \begin{align*}
    S_0 &\to L S' \mid \varepsilon \\ 
    S   &\to L S' \\ 
    S'  &\to b \mid R S \mid S S'' \\ 
    S'' &\to b \mid R S \\
    L   &\to a \\ 
    R   &\to b
  \end{align*}
  
Проверим выводимость цепочки $\omega = a a b b a b$.

Так как трехмерные матрицы рисовать на двумерной бумаге не очень удобно, мы будем иллюстрировать работу алгоритма двумерными матрицами размера $n \times n$, где в ячейках указано множество нетерминалов, выводящих соответствующую подстроку. 

Инициализируем матрицу: 

\begin{center}
  \begin{tabular}{c||cc|cc|cc}
    & $a$ & $a$ & $b$ & $b$ & $a$ & $b$ \\ \hline
    & $1$ & $2$ & $3$ & $4$ & $5$ & $6$ \\ \hline \hline
  $1$ & $\{L\}$ & \o & \o & \o & \o & \o \\ 
  $2$ &   & $\{L\}$ & \o & \o & \o & \o \\ \hline
  $3$ &   &   & $\{R, S', S''\}$ & \o & \o & \o \\ 
  $4$ &   &   &   & $\{R, S', S''\}$ & \o & \o \\ \hline
  5 &   &   &   &   & $\{L\}$ & \o \\ 
  $6$ &   &   &   &   &   & $\{R, S', S''\}$
  \end{tabular}
\end{center}

Заполняем следующую диагональ:

\begin{center}
  \begin{tabular}{c||cc|cc|cc}
    & $a$ & $a$ & $b$ & $b$ & $a$ & $b$ \\ \hline
    & $1$ & $2$ & $3$ & $4$ & 5 & $6$ \\ \hline \hline
  $1$ & $\{L\}$ & \o & \o & \o & \o & \o \\ 
  $2$ &   & $\{L\}$ & $\{S\}$ & \o & \o & \o \\ \hline
  $3$ &   &   & $\{R, S', S''\}$ & \o & \o & \o \\ 
  $4$ &   &   &   & $\{R, S', S''\}$ & \o & \o \\ \hline
  5 &   &   &   &   & $\{L\}$ & $\{S\}$ \\ 
  $6$ &   &   &   &   &   & $\{R, S', S''\}$
  \end{tabular}
\end{center}

Заполняем следующую диагональ:

\begin{center}
  \begin{tabular}{c||cc|cc|cc}
    & $a$ & $a$ & $b$ & $b$ & $a$ & $b$ \\ \hline
    & $1$ & $2$ & $3$ & $4$ & 5 & $6$ \\ \hline \hline
  $1$ & $\{L\}$ & \o & \o & \o & \o & \o \\ 
  $2$ &   & $\{L\}$ & $\{S\}$ & $\{S'\}$ & \o & \o \\ \hline
  $3$ &   &   & $\{R, S', S''\}$ & \o & \o & \o \\ 
  $4$ &   &   &   & $\{R, S', S''\}$ & \o & $\{S', S''\}$ \\ \hline
  5 &   &   &   &   & $\{L\}$ & $\{S\}$ \\ 
  $6$ &   &   &   &   &   & $\{R, S', S''\}$
  \end{tabular}
\end{center}

Заполняем следующую диагональ:

\begin{center}
  \begin{tabular}{c||cc|cc|cc}
    & $a$ & $a$ & $b$ & $b$ & $a$ & $b$ \\ \hline
    & $1$ & $2$ & $3$ & $4$ & 5 & $6$ \\ \hline \hline
  $1$ & $\{L\}$ & \o & \o & $\{S, S_0\}$ & \o & \o \\ 
  $2$ &   & $\{L\}$ & $\{S\}$ & $\{S'\}$ & \o & \o \\ \hline
  $3$ &   &   & $\{R, S', S''\}$ & \o & \o & \o \\ 
  $4$ &   &   &   & $\{R, S', S''\}$ & \o & $\{S', S''\}$ \\ \hline
  5 &   &   &   &   & $\{L\}$ & $\{S\}$ \\ 
  $6$ &   &   &   &   &   & $\{R, S', S''\}$
  \end{tabular}
\end{center}

Заполняем следующую диагональ:

\begin{center}
  \begin{tabular}{c||cc|cc|cc}
    & $a$ & $a$ & $b$ & $b$ & $a$ & $b$ \\ \hline
    & $1$ & $2$ & $3$ & $4$ & 5 & $6$ \\ \hline \hline
  $1$ & $\{L\}$ & \o & \o & $\{S, S_0\}$ & \o & \o \\ 
  $2$ &   & $\{L\}$ & $\{S\}$ & $\{S'\}$ & \o & $\{S'\}$ \\ \hline
  $3$ &   &   & $\{R, S', S''\}$ & \o & \o & \o \\ 
  $4$ &   &   &   & $\{R, S', S''\}$ & \o & $\{S', S''\}$ \\ \hline
  5 &   &   &   &   & $\{L\}$ & $\{S\}$ \\ 
  $6$ &   &   &   &   &   & $\{R, S', S''\}$
  \end{tabular}
\end{center}

Заполняем последнюю оставшуюся ячейку:

\begin{center}
  \begin{tabular}{c||cc|cc|cc}
    & $a$ & $a$ & $b$ & $b$ & $a$ & $b$ \\ \hline
    & $1$ & $2$ & $3$ & $4$ & 5 & $6$ \\ \hline \hline
  $1$ & $\{L\}$ & \o & \o & $\{S, S_0\}$ & \o & $\{S, S_0\}$ \\ 
  $2$ &   & $\{L\}$ & $\{S\}$ & $\{S'\}$ & \o & $\{S'\}$ \\ \hline
  $3$ &   &   & $\{R, S', S''\}$ & \o & \o & \o \\ 
  $4$ &   &   &   & $\{R, S', S''\}$ & \o & $\{S', S''\}$ \\ \hline
  5 &   &   &   &   & $\{L\}$ & $\{S\}$ \\ 
  $6$ &   &   &   &   &   & $\{R, S', S''\}$
  \end{tabular}
\end{center}

Стартовый нетерминал находится в верхней правой ячейке, а значит цепочка $a a b b a b$ выводима в нашей грамматике.

\end{example}

\begin{example}
  Теперь выполним алгоритм на невыводимой цепочке $abaa$. 

  Инициализируем таблицу:

  \begin{center}
    \begin{tabular}{c||cc|cc}
      & $a$ & $b$ & $a$ & $a$ \\ \hline
      & $1$ & $2$ & $3$ & 4 \\ \hline \hline 
    $1$ & $\{L\}$ & \o & \o & \o \\ 
    $2$ &   & $\{R, S', S''\}$ & \o & \o \\ 
    $3$ &   &   & $\{L\}$ & \o \\ \hline
    $4$ &   &   &   & $\{L\}$ \\ 
    \end{tabular}
  \end{center}

  Заполняем следующую диагональ: 

  \begin{center}
    \begin{tabular}{c||cc|cc}
      & $a$ & $b$ & $a$ & $a$ \\ \hline
      & $1$ & $2$ & $3$ & 4 \\ \hline \hline 
    $1$ & $\{L\}$ & $\{S, S_0\}$ & \o & \o \\ 
    $2$ &   & $\{R, S', S''\}$ & \o & \o \\ 
    $3$ &   &   & $\{L\}$ & \o \\ \hline
    $4$ &   &   &   & $\{L\}$ \\ 
    \end{tabular}
  \end{center}


  Больше ни одну ячейку в таблице заполнить нельзя, а значит эта строка не выводится в грамматике правильных скобочных последовательностей. 

\end{example}

\subsection{Алгоритм для графов на основе CYK}

Данный алгоритм накладывает ограничение на форму грамматики: грамматика должна быть в ``ослабленной'' нормальной форме Хомского~\ref{section:CNF}.
Не будем требовать отсутсвия пустого и стартового в правой части.

Обобщение.
Смотрим на транзитивное замыкание.

\subsection{Алгоритм на основе матриц}

Ссылка на Валианта~\cite{!!!}.

Оригинальные матрицы (Рустам)~\cite{Azimov:2018:CPQ:3210259.3210264}

Кратчайшие.

Одно дерево?

\subsection{Конъюнктивные и булевы граммтики}

\subsubsection{Определения}

Охотин~\cite{!!!}.

\subsubsection{Для графов}

Классическая семантика --- работает для конъюнктивных для любых графов.
Для Булевых и конъюнктивных только для графов без циклов.

Альтернативная семантика (DataLog).
Трактуем конъюнкцию как в даталоге. Тогда всё хорошо.
Это похоже на даталог через линейную алгебру~\cite{!!!}

\subsection{Особенности реализации матричного алгоритма}

Кое-что про наши реализации~\cite{Mishin:2019:ECP:3327964.3328503}

Разреженные матрицы, плотные матрицы, GraphBLAS\footnote{!!!}, GPGPU, CUTLASS\footnote{Репозиторий библиотеки CUTLASS: \url{https://github.com/NVIDIA/cutlass}}.

Расположенеи в памяти: хорошо, когда всё влезло на одну карту.

Распределённые решения.
Через GraphBLAS

\subsection{Обзор}

Китайцы~\cite{!!!}, Брэдфорд~\cite{!!!}, Ли~\cite{Lee:2002:FCG:505241.505242}, Хеллингс~\cite{!!!}, OpenCypher~\cite{Kuijpers:2019:ESC:3335783.3335791}.

Рассуждения про ассимптотику.

Субкубический для частного случая (Брэдфорд)~\cite{8249039}.

\subsection{Вопросы и задачи}
\begin{enumerate}
  \item !!!
\end{enumerate}
